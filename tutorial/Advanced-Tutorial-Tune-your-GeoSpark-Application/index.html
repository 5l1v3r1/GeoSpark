<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>Tune GeoSpark core - GeoSpark Documentation</title>
        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        <script src="../../js/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/highlight.pack.js"></script>
        <script>
            (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
            })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

            ga('create', 'UA-64886725-1', 'www.public.asu.edu/~jiayu2/geospark/index.html');
            ga('send', 'pageview');
        </script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="../..">GeoSpark Documentation</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="../..">Home</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">News <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../news/GeoSpark-All-Modules-Release-notes/">Release notes</a>
</li>
                            
<li >
    <a href="../../news/GeoSpark-All-Modules-Maven-Central-Coordinates/">Maven Central Coordinate</a>
</li>
                            
<li >
    <a href="../../news/publication/">Publications</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Download <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../../download/overview/">Overview</a>
</li>
                            
<li >
    <a href="../../download/cluster/">Set up Spark cluser</a>
</li>
                            
<li >
    <a href="../../download/scalashell/">Spark Scala shell</a>
</li>
                            
<li >
    <a href="../../download/project/">Self-contain project</a>
</li>
                            
<li >
    <a href="../../download/compile/">Compile the source code</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">API <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
  <li class="dropdown-submenu">
    <a href="#">GeoSpark core</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../api/GeoSpark-Scala-and-Java-API/">Scala/Java doc</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">GeoSpark SQL</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../api/sql/GeoSparkSQL-Overview/">Overview</a>
</li>
            
<li >
    <a href="../../api/sql/GeoSparkSQL-Constructor/">Constructor</a>
</li>
            
<li >
    <a href="../../api/sql/GeoSparkSQL-Function/">Function</a>
</li>
            
<li >
    <a href="../../api/sql/GeoSparkSQL-Predicate/">Predicate</a>
</li>
            
<li >
    <a href="../../api/sql/GeoSparkSQL-AggregateFunction/">Aggregate Function</a>
</li>
            
<li >
    <a href="../../api/sql/GeoSparkSQL-Optimizer/">Optimizer</a>
</li>
            
<li >
    <a href="../../api/sql/GeoSparkSQL-Parameter/">Parameter</a>
</li>
    </ul>
  </li>
                            
  <li class="dropdown-submenu">
    <a href="#">GeoSpark viz</a>
    <ul class="dropdown-menu">
            
<li >
    <a href="../../api/Babylon-Scala-and-Java-API/">Scala/Java doc</a>
</li>
    </ul>
  </li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutorial <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../benchmark/">Benchmark</a>
</li>
                            
<li class="active">
    <a href="./">Tune GeoSpark core</a>
</li>
                            
<li >
    <a href="../GeoSpark-Runnable-DEMO/">Runnable demo</a>
</li>
                        </ul>
                    </li>
                    <li >
                        <a href="../../contact/">Contact</a>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../benchmark/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../GeoSpark-Runnable-DEMO/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
                    <li>
                        <a href="https://github.com/DataSystemsLab/GeoSpark/edit/master/docs/tutorial/Advanced-Tutorial-Tune-your-GeoSpark-Application.md"><i class="fa fa-github"></i> Edit on GitHub</a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#advanced-tutorial-tune-your-geospark-application">Advanced tutorial: Tune your GeoSpark application</a></li>
            <li><a href="#pick-a-proper-geospark-version">Pick a proper GeoSpark version</a></li>
            <li><a href="#choose-a-proper-spatial-rdd-constructor">Choose a proper Spatial RDD constructor</a></li>
            <li><a href="#cache-the-spatial-rdd-that-is-repeatedly-used">Cache the Spatial RDD that is repeatedly used</a></li>
            <li><a href="#be-aware-of-spatial-rdd-partitions">Be aware of Spatial RDD partitions</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="advanced-tutorial-tune-your-geospark-application">Advanced tutorial: Tune your GeoSpark application</h1>
<p>Before getting into this advanced tutorial, please make sure that you have tried several GeoSpark functions on your local machine.</p>
<h2 id="pick-a-proper-geospark-version">Pick a proper GeoSpark version</h2>
<p>The versions of GeoSpark have three levels: X.X.X (i.e., 0.8.1). In addition, GeoSpark also supports Spark 1.X in Spark1.X version.</p>
<p>The first level means that this verion contains big structure redesign which may bring big changes in APIs and performance. Hopefully, we can see these big changes in GeoSpark 1.X version.</p>
<p>The second level (i.e., 0.8) indicates that this version contains significant performance enhancement, big new features and API changes. An old GeoSpark user who wants to pick this version needs to be careful about the API changes. Before you move to this version, please read <a href="https://github.com/DataSystemsLab/GeoSpark/wiki/GeoSpark-Full-Version-Release-notes">GeoSpark version release notes</a> and make sure you are ready to accept the API changes.</p>
<p>The third level (i.e., 0.8.1) tells that this version only contains bug fixes, some small new features and slight performance enhancement. This version will not contain any API changes. Moving to this version is safe. We highly suggest all GeoSpark users that stay at the same level move to the latest version in this level.</p>
<h2 id="choose-a-proper-spatial-rdd-constructor">Choose a proper Spatial RDD constructor</h2>
<p>GeoSpark provides a number of constructors for each SpatialRDD (PointRDD, PolygonRDD and LineStringRDD). In general, you have two options to start with.</p>
<ol>
<li>
<p>Initialize a SpatialRDD from your data source such as HDFS and S3. A typical example is as follows:</p>
<p><code>public PointRDD(JavaSparkContext sparkContext, String InputLocation, Integer Offset, 
FileDataSplitter splitter, boolean carryInputData, Integer partitions, StorageLevel newLevel)</code>
2. Initialize a SpatialRDD from an existing RDD. A typical example is as follows:</p>
<p><code>public PointRDD(JavaRDD&lt;Point&gt; rawSpatialRDD, StorageLevel newLevel)</code></p>
</li>
</ol>
<p>You may notice that these constructors all take as input a "StorageLevel" parameter. This is to tell Apache Spark cache the "rawSpatialRDD", one attribute of SpatialRDD. The reason why GeoSpark does this is that GeoSpark wants to calculate the dataset boundary and approximate total count using several Apache Spark "Action"s. These information are useful when doing Spatial Join Query and Distance Join Query.</p>
<p>However, in some cases, you may know well about your datasets. If so, you can manually provide these information by calling this kind of Spatial RDD constructors:</p>
<pre><code>    public PointRDD(JavaSparkContext sparkContext, String InputLocation, Integer Offset,
    FileDataSplitter splitter, boolean carryInputData, Integer partitions,
    Envelope datasetBoundary, Integer approximateTotalCount) {
</code></pre>

<p>Manually providing the dataset boundary and approxmiate total count helps GeoSpark avoiding several slow "Action"s during initialization.</p>
<h2 id="cache-the-spatial-rdd-that-is-repeatedly-used">Cache the Spatial RDD that is repeatedly used</h2>
<p>Each SpatialRDD (PointRDD, PolygonRDD and LineStringRDD) possesses four RDD attributes. They are:</p>
<ol>
<li>rawSpatialRDD: The RDD generated by SpatialRDD constructors.</li>
<li>spatialPartitionedRDD: The RDD generated by spatial partition a rawSpatialRDD. Note that: this RDD has replicated spatial objects.</li>
<li>indexedRawRDD: The RDD generated by indexing a rawSpatialRDD.</li>
<li>indexedRDD: The RDD generated by indexing a spatialPartitionedRDD. Note that: this RDD has replicated spatial objects.</li>
</ol>
<p>These four RDDs don't co-exist so you don't need to worry about the memory issue.
These four RDDs are invoked in different queries:</p>
<ol>
<li>Spatial Range Query / KNN Query, no index: rawSpatialRDD is used.</li>
<li>Spatial Range Query / KNN Query, use index: indexedRawRDD is used.</li>
<li>Spatial Join Query / Distance Join Query, no index: spatialPartitionedRDD is used.</li>
<li>Spatial Join Query / Distance Join Query, use index: indexed RDD is used.</li>
</ol>
<p>Therefore, if you use one of the queries above many times, you'd better cache the associated RDD into memory. There are several possible use cases:</p>
<ol>
<li>In Spatial Data Mining such as Spatial Autocorrelation and Spatial Co-location Pattern Mining, you may need to use Spatial Join / Spatial Self-join iteratively in order to calculate the adjacency matrix. If so, please cache the spatialPartitionedRDD/indexedRDD which is queries many times.</li>
<li>In Spark RDD sharing applications such as <a href="https://github.com/cloudera/livy">Livy</a> and <a href="https://github.com/spark-jobserver/spark-jobserver">Spark Job Server</a>, many users may do Spatial Range Query / KNN Query on the same Spatial RDD with different query predicates. You'd better cache the rawSpatialRDD/indexedRawRDD.</li>
</ol>
<h2 id="be-aware-of-spatial-rdd-partitions">Be aware of Spatial RDD partitions</h2>
<p>Sometimes users complain that the execution time is slow in some cases. As the first step, you should always consider increasing the number of your SpatialRDD partitions (2 - 8 times more than the original number). You can do this when you initialize a SpatialRDD. This may significantly improve your performance.</p>
<p>After that, you may consider tuning some other parameters in Apache Spark. For example, you may use Kyro serializer or change the RDD fraction that is cached into memory.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '../..';</script>
        <script src="../../js/base.js"></script>
        <script src="../../search/require.js"></script>
        <script src="../../search/search.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td><kbd>&larr;</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td><kbd>&rarr;</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>


    </body>
</html>
