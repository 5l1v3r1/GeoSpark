<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Tune GeoSpark core - GeoSpark Documentation</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Tune GeoSpark core";
    var mkdocs_page_input_path = "tutorial/Advanced-Tutorial-Tune-your-GeoSpark-Application.md";
    var mkdocs_page_url = "/tutorial/Advanced-Tutorial-Tune-your-GeoSpark-Application/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> GeoSpark Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">News</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../news/GeoSpark-All-Modules-Release-notes/">Release notes</a>
                </li>
                <li class="">
                    
    <a class="" href="../../news/GeoSpark-All-Modules-Maven-Central-Coordinates/">Maven Centrl Coordinate</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Download</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../download/overview/">Overview</a>
                </li>
                <li class="">
                    
    <a class="" href="../../download/cluster/">Set up Spark cluser</a>
                </li>
                <li class="">
                    
    <a class="" href="../../download/scalashell/">Spark Scala shell</a>
                </li>
                <li class="">
                    
    <a class="" href="../../download/project/">Self-contain project</a>
                </li>
                <li class="">
                    
    <a class="" href="../../download/compile/">Compile the source code</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../publication/">Publications</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../../contact/">Contact</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">API</span>
    <ul class="subnav">
                <li class="">
                    
    <span class="caption-text">GeoSpark core</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../api/GeoSpark-Scala-and-Java-API/">Scala/Java doc</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">GeoSpark SQL</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../api/sql/GeoSparkSQL-Overview/">Overview</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../api/sql/GeoSparkSQL-Constructor/">Constructor</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../api/sql/GeoSparkSQL-Function/">Function</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../api/sql/GeoSparkSQL-Predicate/">Predicate</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../api/sql/GeoSparkSQL-AggregateFunction/">Aggregate Function</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../api/sql/GeoSparkSQL-Optimizer/">Optimizer</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../api/sql/GeoSparkSQL-Parameter/">Parameter</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">GeoSpark viz</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../api/Babylon-Scala-and-Java-API/">Scala/Java doc</a>
                </li>
    </ul>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Tutorial</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../benchmark/">Benchmark</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Tune GeoSpark core</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#advanced-tutorial-tune-your-geospark-application">Advanced tutorial: Tune your GeoSpark application</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#pick-a-proper-geospark-version">Pick a proper GeoSpark version</a></li>
        
            <li><a class="toctree-l4" href="#choose-a-proper-spatial-rdd-constructor">Choose a proper Spatial RDD constructor</a></li>
        
            <li><a class="toctree-l4" href="#cache-the-spatial-rdd-that-is-repeatedly-used">Cache the Spatial RDD that is repeatedly used</a></li>
        
            <li><a class="toctree-l4" href="#be-aware-of-spatial-rdd-partitions">Be aware of Spatial RDD partitions</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../GeoSpark-Runnable-DEMO/">Runnable demo</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">GeoSpark Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Tutorial &raquo;</li>
        
      
    
    <li>Tune GeoSpark core</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="advanced-tutorial-tune-your-geospark-application">Advanced tutorial: Tune your GeoSpark application</h1>
<p>Before getting into this advanced tutorial, please make sure that you have tried several GeoSpark functions on your local machine.</p>
<h2 id="pick-a-proper-geospark-version">Pick a proper GeoSpark version</h2>
<p>The versions of GeoSpark have three levels: X.X.X (i.e., 0.8.1). In addition, GeoSpark also supports Spark 1.X in Spark1.X version.</p>
<p>The first level means that this verion contains big structure redesign which may bring big changes in APIs and performance. Hopefully, we can see these big changes in GeoSpark 1.X version.</p>
<p>The second level (i.e., 0.8) indicates that this version contains significant performance enhancement, big new features and API changes. An old GeoSpark user who wants to pick this version needs to be careful about the API changes. Before you move to this version, please read <a href="https://github.com/DataSystemsLab/GeoSpark/wiki/GeoSpark-Full-Version-Release-notes">GeoSpark version release notes</a> and make sure you are ready to accept the API changes.</p>
<p>The third level (i.e., 0.8.1) tells that this version only contains bug fixes, some small new features and slight performance enhancement. This version will not contain any API changes. Moving to this version is safe. We highly suggest all GeoSpark users that stay at the same level move to the latest version in this level.</p>
<h2 id="choose-a-proper-spatial-rdd-constructor">Choose a proper Spatial RDD constructor</h2>
<p>GeoSpark provides a number of constructors for each SpatialRDD (PointRDD, PolygonRDD and LineStringRDD). In general, you have two options to start with.</p>
<ol>
<li>
<p>Initialize a SpatialRDD from your data source such as HDFS and S3. A typical example is as follows:</p>
<p><code>public PointRDD(JavaSparkContext sparkContext, String InputLocation, Integer Offset, 
FileDataSplitter splitter, boolean carryInputData, Integer partitions, StorageLevel newLevel)</code>
2. Initialize a SpatialRDD from an existing RDD. A typical example is as follows:</p>
<p><code>public PointRDD(JavaRDD&lt;Point&gt; rawSpatialRDD, StorageLevel newLevel)</code></p>
</li>
</ol>
<p>You may notice that these constructors all take as input a "StorageLevel" parameter. This is to tell Apache Spark cache the "rawSpatialRDD", one attribute of SpatialRDD. The reason why GeoSpark does this is that GeoSpark wants to calculate the dataset boundary and approximate total count using several Apache Spark "Action"s. These information are useful when doing Spatial Join Query and Distance Join Query.</p>
<p>However, in some cases, you may know well about your datasets. If so, you can manually provide these information by calling this kind of Spatial RDD constructors:</p>
<pre><code>    public PointRDD(JavaSparkContext sparkContext, String InputLocation, Integer Offset,
    FileDataSplitter splitter, boolean carryInputData, Integer partitions,
    Envelope datasetBoundary, Integer approximateTotalCount) {
</code></pre>

<p>Manually providing the dataset boundary and approxmiate total count helps GeoSpark avoiding several slow "Action"s during initialization.</p>
<h2 id="cache-the-spatial-rdd-that-is-repeatedly-used">Cache the Spatial RDD that is repeatedly used</h2>
<p>Each SpatialRDD (PointRDD, PolygonRDD and LineStringRDD) possesses four RDD attributes. They are:</p>
<ol>
<li>rawSpatialRDD: The RDD generated by SpatialRDD constructors.</li>
<li>spatialPartitionedRDD: The RDD generated by spatial partition a rawSpatialRDD. Note that: this RDD has replicated spatial objects.</li>
<li>indexedRawRDD: The RDD generated by indexing a rawSpatialRDD.</li>
<li>indexedRDD: The RDD generated by indexing a spatialPartitionedRDD. Note that: this RDD has replicated spatial objects.</li>
</ol>
<p>These four RDDs don't co-exist so you don't need to worry about the memory issue.
These four RDDs are invoked in different queries:</p>
<ol>
<li>Spatial Range Query / KNN Query, no index: rawSpatialRDD is used.</li>
<li>Spatial Range Query / KNN Query, use index: indexedRawRDD is used.</li>
<li>Spatial Join Query / Distance Join Query, no index: spatialPartitionedRDD is used.</li>
<li>Spatial Join Query / Distance Join Query, use index: indexed RDD is used.</li>
</ol>
<p>Therefore, if you use one of the queries above many times, you'd better cache the associated RDD into memory. There are several possible use cases:</p>
<ol>
<li>In Spatial Data Mining such as Spatial Autocorrelation and Spatial Co-location Pattern Mining, you may need to use Spatial Join / Spatial Self-join iteratively in order to calculate the adjacency matrix. If so, please cache the spatialPartitionedRDD/indexedRDD which is queries many times.</li>
<li>In Spark RDD sharing applications such as <a href="https://github.com/cloudera/livy">Livy</a> and <a href="https://github.com/spark-jobserver/spark-jobserver">Spark Job Server</a>, many users may do Spatial Range Query / KNN Query on the same Spatial RDD with different query predicates. You'd better cache the rawSpatialRDD/indexedRawRDD.</li>
</ol>
<h2 id="be-aware-of-spatial-rdd-partitions">Be aware of Spatial RDD partitions</h2>
<p>Sometimes users complain that the execution time is slow in some cases. As the first step, you should always consider increasing the number of your SpatialRDD partitions (2 - 8 times more than the original number). You can do this when you initialize a SpatialRDD. This may significantly improve your performance.</p>
<p>After that, you may consider tuning some other parameters in Apache Spark. For example, you may use Kyro serializer or change the RDD fraction that is cached into memory.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../GeoSpark-Runnable-DEMO/" class="btn btn-neutral float-right" title="Runnable demo">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../benchmark/" class="btn btn-neutral" title="Benchmark"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../benchmark/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../GeoSpark-Runnable-DEMO/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/require.js"></script>
      <script src="../../search/search.js"></script>

</body>
</html>
